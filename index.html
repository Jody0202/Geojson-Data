<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Article 4 Map</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
    <style>
        #map {
            width: 100%;
            height: 600px;
        }
        .search-container {
            margin-bottom: 10px;
        }
    </style>
</head>
<body>

<div class="search-container">
    <input type="text" id="postcode-input" placeholder="Enter postcode">
    <button onclick="searchPostcode()">Search Postcode</button>
</div>
<div id="map"></div>

<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
<script src="https://unpkg.com/leaflet-control-geocoder/dist/Control.Geocoder.js"></script>
<script>

// List of Article 4 Direction codes and their meanings
const article4Codes = {
    '1A': 'Restrictions on Enlargement, improvement or other alteration of a dwellinghouse e.g. Extensions.',
    '1AA': 'Restrictions on Enlargement of a dwellinghouse by construction of additional storeys',
    '1B': 'Restrictions on Additions etc to the roof of a dwellinghouse e.g. Dormers',
    '1C': 'Restrictions on Any other alterations to a roof of a dwellinghouse',
    '1D': 'Restrictions on Porches',
    '1E': 'Restrictions on Buildings etc incidental to the enjoyment of a dwellinghouse e.g. Outbuildings',
    '1F': 'Restrictions on Hard surfaces incidental to the enjoyment of a dwellinghouse',
    '1G': 'Restrictions on Chimneys, flues etc on a dwellinghouse',
    '1H': 'Restrictions on Microwave antenna on a dwellinghouse e.g. Satellite dishes',
    '2A': 'Restrictions on Gates, fences, walls etc',
    '2B': 'Restrictions on Means of access to a highway e.g. driveways',
    '2C': 'Restrictions on Exterior painting',
    '2D': 'Restrictions on Electrical outlet for recharging vehicles',
    '2E': 'Restrictions on Electrical upstand for recharging vehicles',
    '2F': 'Restrictions on Closed circuit television cameras â€“ CCTV',
    '2G': 'Restrictions on Moveable structures for pubs, restaurants etc',
    '3L': 'Restrictions on Small Houses in Multiple Occupation (HMOs) to dwellinghouses and vice versa'
};

// Function to display restrictions based on the codes
function displayArticle4Restrictions(codes) {
    const codeList = codes.split('-');
    let restrictions = '';

    codeList.forEach(code => {
        if (article4Codes[code]) {
            restrictions += `<li>${article4Codes[code]}</li>`;
        }
    });

    // If no known codes are present, just display "Article 4 Direction"
    if (restrictions === '') {
        restrictions = '<li>Article 4 Direction</li>';
    }

    return `<ul>${restrictions}</ul>`;
}

// Initialize the map
const map = L.map('map').setView([52.5, -1.9], 13); // Adjust coordinates and zoom to your area

// Add the base layer (e.g., OpenStreetMap)
L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
    attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
}).addTo(map);

// Load the GeoJSON data for Article 4 areas (Replace with your own GeoJSON URL or object)
const article4Data = {};  // Your GeoJSON data should be loaded here

// Add the GeoJSON layer to the map
const geojsonLayer = L.geoJson(article4Data, {
    onEachFeature: function (feature, layer) {
        if (feature.properties && feature.properties['permitted-development-rights']) {
            const permittedCodes = feature.properties['permitted-development-rights'];
            const popupContent = `<strong>Article 4 Direction Restrictions</strong><br>` +
                displayArticle4Restrictions(permittedCodes);
            layer.bindPopup(popupContent);
        }
    }
}).addTo(map);

// Geocoder for postcode search
const geocoder = L.Control.Geocoder.nominatim();

// Function to search postcode and pin it on the map
function searchPostcode() {
    const postcode = document.getElementById('postcode-input').value;
    
    geocoder.geocode(postcode, function(results) {
        if (results.length > 0) {
            const result = results[0];
            const latlng = result.center;

            // Place a marker at the postcode location
            const marker = L.marker(latlng).addTo(map);

            // Zoom to the marker location
            map.setView(latlng, 16);

            // Check if the marker is inside any Article 4 area and display the restrictions
            geojsonLayer.eachLayer(function (layer) {
                const bounds = layer.getBounds();
                if (bounds.contains(latlng)) {
                    const permittedCodes = layer.feature.properties['permitted-development-rights'];
                    const restrictionsContent = displayArticle4Restrictions(permittedCodes);

                    marker.bindPopup(`<strong>Article 4 Direction Restrictions</strong><br>${restrictionsContent}`)
                        .openPopup();
                }
            });
        } else {
            alert('Postcode not found!');
        }
    });
}

</script>

</body>
</html>
